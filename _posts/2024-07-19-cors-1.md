---
title: ëª¨ìš°ë‹¤ì˜ ì´ìŠˆ í•´ê²°ê¸° - CORS (1)
date: 2024-07-19 HH:MM:SS +09:00
categories: [í…Œë°”]
tags:
  [
    CORS
  ]
---

> CORS(êµì°¨ ì˜¤ë¦¬ì§„ ë¦¬ì†ŒìŠ¤ ê³µìœ )ëŠ” ì„œë²„ê°€ ë¸Œë¼ìš°ì €ê°€ ë¦¬ì†ŒìŠ¤ ë¡œë”©ì„ í—ˆìš©í•´ì•¼ í•˜ëŠ” ìì²´ ì˜¤ë¦¬ì§„ ì´ì™¸ì˜ ëª¨ë“  ì˜¤ë¦¬ì§„(ë„ë©”ì¸, ìŠ¤í‚¤ë§ˆ ë˜ëŠ” í¬íŠ¸)ì„ í‘œì‹œí•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” HTTP í—¤ë” ê¸°ë°˜ ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤. - MDN

ëª¨ë“  ì›¹ ê°œë°œ íŒ€ë“¤ì´ í•œë²ˆì€ ë§Œë‚˜ì•¼ë§Œ í•˜ëŠ” CORS ë¬¸ì œ, ëª¨ìš°ë‹¤ íŒ€ë„ ì˜ˆì™¸ëŠ” ì•„ë‹ˆê² ì£ . ëª¨ìš°ë‹¤ íŒ€ì´ ì–´ë–»ê²Œ CORS ë¬¸ì œë¥¼ ë§Œë‚˜ê²Œ ë˜ì—ˆê³  ë˜ ì–´ë–»ê²Œ í•´ê²°í–ˆëŠ”ì§€ ê³µìœ í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

# CORSë€ ë¬´ì—‡ì¸ê°€?

ì•„ì‰½ê²Œë„ ëª¨ìš°ë‹¤ê°€ CORS ë¬¸ì œë¥¼ ì§ë©´í–ˆì„ ë•Œì—ëŠ” íŒ€ì› ì¤‘ ëˆ„êµ¬ë„ í•´ë‹¹ ì´ìŠˆì— ëŒ€í•´ ì˜ ì•Œë˜ íŒ€ì›ì´ ì—†ì—ˆì–´ìš”. ê·¸ë˜ì„œ ëª¨ìš°ë‹¤ëŠ” ë¨¼ì € CORSê°€ ë¬´ì—‡ì¸ì§€ ë¶€í„° í•™ìŠµí•´ì•¼ í–ˆìŠµë‹ˆë‹¤. ì§€í”¼ì§€ê¸°ë©´ ë°±ì „ë°±ìŠ¹ì´ë‹ˆê¹Œìš”!

## ê·¸ë˜ì„œ CORSê°€ ë­”ë°ìš”?

CORS(Cross-Origin Resource Sharing)ëŠ” í•œê¸€ë¡œ ë²ˆì—­í•˜ë©´ **êµì°¨ ì¶œì²˜ ë¦¬ì†ŒìŠ¤ ê³µìœ **ì…ë‹ˆë‹¤. ë²ˆì—­í•´ì„œ ë³´ë‹ˆ ëŒ€ì¶© ê°ì´ ì˜µë‹ˆë‹¤. ì„œë¡œ ë‹¤ë¥¸ ì¶œì²˜ë¡œ ë¶€í„° ë„ë‹¬í•œ ë¦¬ì†ŒìŠ¤ ê³µìœ ê°€ í—ˆìš©ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤ê³  ì§ì‘í•  ìˆ˜ ìˆì£ . ê·¸ëŸ¼ Origin, ì¦‰ ì¶œì²˜ë€ ë„ëŒ€ì²´ ë¬´ì—‡ì„ ë§í•˜ëŠ” ê±¸ê¹Œìš”?

![image](https://github.com/user-attachments/assets/dfb2a36e-4a14-4d1f-9a74-09aa6c783421)


ìš°ë¦¬ëŠ” ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•  ë•Œ ì£¼ì†Œì°½ì— urlì„ ì…ë ¥í•©ë‹ˆë‹¤. url ì•ˆì—ëŠ” ë‹¤ì–‘í•œ ìš”ì†Œê°€ ë“¤ì–´ìˆì§€ë§Œ ì—¬ê¸°ì„œ **ì˜¤ë¦¬ì§„ì€ ë”± Protocol, domain(hostname), port** ê¹Œì§€ë¥¼ ì´ì•¼ê¸° í•©ë‹ˆë‹¤. ì¦‰, ì„¸ ê°€ì§€ê°€ ë™ì¼í•˜ë©´ ê°™ì€ ì¶œì²˜ë¡œ, ë‹¤ë¥´ë©´ ë‹¤ë¥¸ ì¶œì²˜ë¡œ ë°”ë¼ë³´ê² ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤. ë”°ë¼ì„œ CORS ì„¤ì •ì´ í•„ìš”í•˜ë‹¤ëŠ” ì—ëŸ¬ë¥¼ ë§Œë‚¬ë‹¤ëŠ” ê²ƒì€ **ì„œë¡œ ë‹¤ë¥¸ ì¶œì²˜ë¡œ ë¶€í„° ì˜¤ëŠ” ìì› ê³µìœ ë¥¼ í—ˆìš©í•˜ë¼**ëŠ” ëœ» ì…ë‹ˆë‹¤. ì•„ë˜ì˜ ì˜ˆì‹œë¥¼ ë³´ë©° ë” ì‰½ê²Œ ì´í•´í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

// TODO: í‘œ ì‚½ì…í•˜ê¸°

## ì™œ CORSê°€ í•„ìš”í•˜ì£ ?

ê²°ë¡ ë¶€í„° ì´ì•¼ê¸° í•˜ë©´, ì›¹ì˜ ê¸°ë³¸ ì •ì±…ì´ **SOP**(**Same-Origin-Policy)** ì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë‹¤ì‹œ ë§í•´, ê°™ì€ ì¶œì²˜ì˜ ìì›ë§Œ í—ˆìš©í•˜ëŠ” ê²ƒì´ ê¸°ë³¸ ì„¤ì •ì´ë¼ëŠ” ë§ì´ì£ . ì™œ ê·¸ëŸ´ê¹Œìš”?

ê³¼ê±°ì˜ ì¸í„°ë„·ì€ (ë‹¹ì—°í•˜ê²Œë„) ì§€ê¸ˆë³´ë‹¤ ë³´ì•ˆì— ëŒ€í•´ ì·¨ì•½í–ˆìŠµë‹ˆë‹¤. íŠ¹íˆ í¬ë¡œìŠ¤ ì‚¬ì´íŠ¸ ìš”ì²­ ìœ„ì¡°(CSRF) ë¬¸ì œê°€ ì‹¬ê°í–ˆìŠµë‹ˆë‹¤. íŠ¹ì • ì›¹ì‚¬ì´íŠ¸ì™€ ë™ì¼í•˜ê²Œ ìƒê¸´ ê°€ì§œ ì‚¬ì´íŠ¸ë¥¼ ë¸Œë¼ìš°ì € ì‚¬ìš©ìì—ê²Œ ì „ë‹¬í•˜ì—¬ ì‚¬ìš©ìì˜ ë‹¤ì–‘í•œ ì •ë³´ë¥¼ ì–»ì–´ë‚´ëŠ” ë°©ì‹ì´ì£ .

ì´ ë¬¸ì œë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ í˜„ëŒ€ì˜ ë¸Œë¼ìš°ì €ì—ì„œëŠ” SOP ì •ì±…ì„ ì‚¬ìš©í•˜ê¸°ë¡œ ê²°ì •í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì‚¬ì‹¤ CORSëŠ” ê°œë°œìë“¤ì„ ê³ í†µ ë°›ê²Œ í•˜ê¸° ìœ„í•¨ì´ ì•„ë‹Œ ì•ˆì „ì„ ìœ„í•œ ì–´ì©” ìˆ˜ ì—†ëŠ” ì„ íƒì´ì—ˆë˜ ê²ƒì´ì£ .

# ìš°ë¦¬ëŠ” ì™œ CORS ë¥¼ ë§ì´í–ˆë‚˜?

> Access to fetch at '[](http://43.202.67.25/v1/moim)[http://xx.xxx.xx.xx/v1/moim](http://xx.xxx.xx.xx/v1/moim)' from origin '[](http://localhost:8080/)[http://localhost:8080](http://localhost:8080)' has been blocked by CORS policy: Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource. If an opaque response serves your needs, set the request's mode to 'no-cors' to fetch the resource with CORS disabled.

ë¬¸ì œëŠ” ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ê°€ í†µì‹ ì„ ì‹œë„í•œ ì²« ìˆœê°„ì´ì—ˆìŠµë‹ˆë‹¤. ë°±ì—”ë“œ API ì„œë²„ëŠ” AWSë¥¼ í†µí•´ ë°°í¬ê°€ ë˜ì–´ìˆëŠ” ìƒíƒœì˜€ê³ , ë¦¬ì•¡íŠ¸ë¡œ ë¹Œë“œí•œ í´ë¼ì´ì–¸íŠ¸ ì•±ì€ ë¡œì»¬ì—ì„œ ì‘ë™í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤. ìœ„ ì—ëŸ¬ ë©”ì‹œì§€ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ê²ƒ ì²˜ëŸ¼ ì„œë¡œ ë‹¤ë¥¸ ì¶œì²˜ì— ì ‘ê·¼í•œ ê²ƒìœ¼ë¡œ ì¸í•´ ë°ì´í„° ìˆ˜ì‹ ì´ ë§‰í˜€ë²„ë¦° ê²ƒì´ì£ .

![image](https://github.com/user-attachments/assets/9ff6e9ca-7655-4ec2-90a4-e4f8258e5398)


ìœ„ì—ì„œ ì„¤ëª…í–ˆë˜ ê²ƒì²˜ëŸ¼ ë¸Œë¼ìš°ì €ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `Same-Origin-Policy` ì…ë‹ˆë‹¤. ë”°ë¼ì„œ ë¦¬ì•¡íŠ¸ ì•±ì´ ë™ì‘ì¤‘ì¸ [`http://localhost:8080`](http://localhost:8080) ë¡œ ë¶€í„° ìì›ì„ ë¨¼ì € ë°›ê³  ì´ë¥¼ ì› ì¶œì²˜ë¡œ ìƒê°í•˜ê²Œ ë©ë‹ˆë‹¤.

ê·¸ í›„ API ì„œë²„ë¥¼ ì ‘ê·¼í•˜ëŠ” ê³¼ì •ì—ì„œ ë¸Œë¼ìš°ì €ëŠ” ì•Œì§€ ëª»í•˜ëŠ” ë°ì´í„° ì†ŒìŠ¤ì¸ `http://xx:xxx:xxx:xx:8080` ë¡œ ë¶€í„° ë°›ì€ ë°ì´í„°ëŠ” ì‹ ë¢°í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ì‚¬ìš©í•˜ì§€ ì•Šê² ë‹¤ëŠ” íŒë‹¨ì„ í•©ë‹ˆë‹¤.

# ëª¨ìš°ë‹¤ê°€ CORS ë¥¼ í•´ê²°í•œ ê³¼ì •
![image](https://github.com/user-attachments/assets/924e0dd7-c53b-4a6c-9fd4-7e104b6251ee)

ê²°ë¡ ì ìœ¼ë¡œ CORS ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„  Cross-Origin ì„ í—ˆìš©í•´ë„ ëœë‹¤ëŠ” ì˜ë¯¸ì˜ í—¤ë”ì¸ `Access-Control-Allow-Origin` ì— í´ë¼ì´ì–¸íŠ¸ ì•±ì˜ Originì„ ì„¤ì •í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. ë¸Œë¼ìš°ì €ì—ì„œ ë¯¿ê³  ì‚¬ìš©í•´ë„ ëœë‹¤ëŠ” ì •ë³´ë¥¼ ì„œë²„ê°€ ì œê³µí•´ì£¼ì–´ì•¼ í•˜ì£ .

## Spring ì—ì„œ CORS í•´ê²°í•˜ê¸°

ëª¨ìš°ë‹¤ ë°±ì—”ë“œ íŒ€ì€ `java 17` ë²„ì „, `SpringBoot 3.3.1` ì˜ í™˜ê²½ì—ì„œ ê°œë°œí•˜ê³  ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  Spring ì—ì„œëŠ” cors ì •ì±… ì„¤ì •ì„ ìœ„í•œ ì¢‹ì€ ë„êµ¬ë¥¼ ì§€ì›í•˜ê³  ìˆìŠµë‹ˆë‹¤. í¬ê²ŒëŠ” ì „ì—­ì„¤ì •ê³¼ Controller í´ë˜ìŠ¤ ì„¤ì •ì´ ìˆìŠµë‹ˆë‹¤. ëª¨ìš°ë‹¤ëŠ” ì´ ì¤‘ì—ì„œ WebConfigurer ë¡œ ì „ì—­ì„¤ì •ì„ ì‚¬ìš©í•˜ê¸°ë¡œ ê²°ì •í–ˆìŠµë‹ˆë‹¤.

### WebConfigurer ë¡œ ì „ì—­ì„¤ì •í•˜ê¸°

```java
@Configuration
public class CorsConfig implements WebMvcConfigurer {

	@Override
	public void addCorsMappings(CorsRegistry registry) {
		registry.addMapping("/**")
			.allowedOrigins("*")
			.allowedMethods("*")
			.allowedHeaders("*")
	}
}

```

Spring ì´ ì œê³µí•˜ëŠ” `WebMvcConfigurer` í´ë˜ìŠ¤ì—ì„œëŠ” CORS ì„¤ì •ì„ ìœ„í•œ `addCorsMappings` ë©”ì†Œë“œë¥¼ ì œê³µí•©ë‹ˆë‹¤. í•´ë‹¹ ë©”ì†Œë“œì—ì„œëŠ” URL íŒ¨í„´, í—ˆìš©í•  Origin ëª©ë¡, ë©”ì†Œë“œ ë“± ì—¬ëŸ¬ ì˜µì…˜ë“¤ì„ ê²°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image](https://github.com/user-attachments/assets/87f362e8-227f-462f-a66a-3c8e2d422795)

ìœ„ ë©”ì†Œë“œë¥¼ í†µí•´ `allowedOrigins(â€*â€)` ë¡œ í•˜ì—¬ ëª¨ë“  ì˜¤ë¦¬ì§„ë“¤ì„ í—ˆìš©í•˜ëŠ” ê²ƒìœ¼ë¡œ ê°„ë‹¨í•˜ê²Œ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ ë³´ì•ˆì ìœ¼ë¡œ ì•ˆì „í•˜ì§€ ëª»í•œ ì„ íƒì´ê² ì£ .

```java
@Configuration
public class CorsConfig implements WebMvcConfigurer {

	@Override
	public void addCorsMappings(CorsRegistry registry) {
		registry.addMapping("/**")
			.allowedOrigins("<http://localhost:8080>", "<https://localhost:8080>")
			.allowedMethods("GET", "POST", "DELETE")
			.allowedHeaders("Authorization", "Content-Type")
			.allowCredentials(true)
			.maxAge(3600);
	}
}


```

ë”°ë¼ì„œ ëª¨ìš°ë‹¤ëŠ” ë³´ë‹¤ ì•ˆì „í•œ í†µì‹ ì„ ìœ„í•´ í—ˆìš©í•  `ë©”ì†Œë“œ`, `origin`, `header` ë¥¼ ì§€ì •í•˜ì˜€ìŠµë‹ˆë‹¤. ìœ„ ì •ë³´ë“¤ì€ ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê±°ë‚˜ í˜¹ í´ë¼ì´ì–¸íŠ¸ url ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œ ìˆ˜ì •ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ `allowCredentials(true)` ì¸ì¦ì •ë³´ë¥¼ ì„¤ì •í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­ì— credentialsë¥¼ í¬í•¨í•˜ê³  ì‘ë‹µì—ì„œ ë°›ì„ ìˆ˜ ìˆë„ë¡ í•˜ì—¬ ë³´ì•ˆì„ ê°•í™”í•˜ì˜€ìŠµë‹ˆë‹¤.

# ë§ˆì¹˜ë©°

CORS ì´ìŠˆë¥¼ ë§ˆì£¼ì¹˜ë©° ëª¨ìš°ë‹¤ëŠ” ì›¹ í†µì‹ ì— ëŒ€í•œ ì´í•´ë¥¼ ë” ë†’ì¼ ìˆ˜ ìˆëŠ” ê¸°íšŒë¥¼ ì–»ì—ˆìŠµë‹ˆë‹¤. ì•ìœ¼ë¡œë„ ë‹¤ì–‘í•œ ì´ìŠˆë¥¼ í•´ê²°í•˜ëŠ” ê¸€ì„ í†µí•´ ëª¨ìš°ë‹¤ íŒ€ì´ ì„±ì¥í•˜ëŠ” ëª¨ìŠµì„ ë³´ì—¬ë“œë¦¬ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤ ğŸ˜Š

# References

-   [https://evan-moon.github.io/2020/05/21/about-cors/](https://evan-moon.github.io/2020/05/21/about-cors/)
-   [https://aws.amazon.com/ko/what-is/cross-origin-resource-sharing/](https://aws.amazon.com/ko/what-is/cross-origin-resource-sharing/)
-   [https://docs.tosspayments.com/resources/glossary/cors#corsêµì°¨-ì¶œì²˜-ë¦¬ì†ŒìŠ¤-ê³µìœ ](https://docs.tosspayments.com/resources/glossary/cors#cors%EA%B5%90%EC%B0%A8-%EC%B6%9C%EC%B2%98-%EB%A6%AC%EC%86%8C%EC%8A%A4-%EA%B3%B5%EC%9C%A0)
